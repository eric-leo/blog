---
title: JSè¿›é˜¶ä¹‹èŠ‚æµã€é˜²æŠ–å®ç°
date: 2018-07-04 10:54:40
type: "js-base"
tag: js
description:
keywords:
top_img:
mathjax:
katex:
aside:
---

## å‰è¨€

å¯¹äº**é˜²æŠ–**å’Œ**èŠ‚æµ**ï¼Œç›¸ä¿¡å¤§å®¶éƒ½å·²ç»å¬äº†å¤ªå¤šå¤ªå¤šï¼Œç½‘ä¸Šåœ¨è¿™ä¸€å—çš„èµ„æ–™ä¹Ÿæœ‰å¾ˆå¤šã€‚åœ¨çœŸæ­£ä½¿ç”¨å®ƒä¹‹å‰æˆ‘ä¹Ÿæ›¾æŒ‰ç…§ç½‘ä¸Šçš„æ•™ç¨‹æ‰‹å†™è¿‡å‡ ä¸ªä¸åŒçš„ç‰ˆæœ¬ï¼Œæœ€è¿‘åœ¨å·¥ä½œä¸­çœŸæ­£è¦ç”¨ä¸Šçš„æ—¶å€™ï¼Œæ‰å‘ç°ä¹‹å‰å¯¹å…¶çš„ç†è§£è¿˜ä¸å¤Ÿæ·±åˆ»ã€‚æ‰€ä»¥ä»Šå¤©åœ¨è¿™é‡Œå¥½å¥½çš„æ¢³ç†ä¸€ä¸‹å®ƒä»¬ï¼Œè´´ä¸Šä¸€ä¸ªæ¯”è¾ƒå…¨çš„å®ç°æ–¹å¼ï¼Œå¦å¤–ä»‹ç»ä¸€ä¸‹å®é™…å·¥ä½œä¸­æ˜¯æ€æ ·ä½¿ç”¨çš„ã€‚

## ä¸ºä»€ä¹ˆè¦ç”¨é˜²æŠ–èŠ‚æµï¼Ÿ

é¦–å…ˆæƒ³è¦è¯´æ˜çš„æ˜¯ä¸ºä»€ä¹ˆéœ€è¦ä½¿ç”¨åˆ°**é˜²æŠ–**å’Œ**èŠ‚æµ**ï¼Œè‹¥æ˜¯å·²ç»æ¸…æ¥šçš„å°ä¼™å¯ä»¥ç›´æ¥è·³è¿‡é˜…è¯»åé¢çš„å†…å®¹ï¼Œè‹¥ä½ å’Œæˆ‘ä¸€æ ·åœ¨ä½¿ç”¨åœºæ™¯ä¸Šè¿˜å­˜åœ¨ä¸€äº›ç–‘æƒ‘çš„è¯å¯ä»¥ä»”ç»†çœ‹çœ‹è¿™ä¸€å—å†…å®¹ï¼Œæˆ‘ä¼šå°½é‡è¯´çš„æ¸…æ™°ä¸€äº›ã€‚

**åœºæ™¯ä¸€**

æœ‰è¿™ä¹ˆä¸€ä¸ªéœ€æ±‚ï¼Œç”¨æˆ·åœ¨ç‚¹å‡»æŸä¸ªæŒ‰é’®çš„æ—¶å€™ä¼šè§¦å‘ä¸€äº›ä»»åŠ¡äº‹ä»¶ã€‚ä½†è‹¥æ˜¯ä»–åœ¨å¾ˆçŸ­çš„æ—¶é—´å†…è¿ç»­çš„ç‚¹å‡»æŒ‰é’®ï¼Œåˆ™ä¼šä¸åœçš„è§¦å‘ä»»åŠ¡äº‹ä»¶ï¼Œä½†æˆ‘ä»¬æƒ³è¦è¿™ä¸ªä»»åŠ¡äº‹ä»¶åœ¨ä¸€å®šæ—¶é—´å†…åªèƒ½è§¦å‘ä¸€æ¬¡(ä¸ç®¡æŒ‰é’®è¢«ç‚¹å‡»äº†å‡ æ¬¡)ï¼Œç„¶åè¿‡äº†è¿™ä¸ªæ—¶é—´å†æ¬¡ç‚¹å‡»å°±åˆå¯ä»¥è§¦å‘äº†ã€‚

å¦‚å›¾ï¼š

æ­¤æ—¶ï¼Œåƒè¿™ç§**é¢‘ç¹çš„è§¦å‘ä»»åŠ¡äº‹ä»¶ï¼Œä½†å´åªæƒ³è¦å®ƒåœ¨ä¸€å®šæ—¶é—´å†…åªæ‰§è¡Œä¸€æ¬¡ï¼Œè¿‡äº†è¿™ä¸ªæ—¶é—´åˆèƒ½ç»§ç»­è§¦å‘**çš„æƒ…å†µæˆ‘ä»¬å°±ç§°ä¹‹ä¸º**é˜²æŠ–**ã€‚

ä½†åœ¨å®é™…å·¥ä½œä¸­ï¼Œæˆ‘ä»¬å‘ç°ä¸Šé¢é¿å…æŒ‰é’®é‡å¤ç‚¹å‡»çš„æƒ…å†µä¸€èˆ¬éƒ½å¯ä»¥ç»™æŒ‰é’®å¢åŠ ä¸€ä¸ª`loading`çš„æ•ˆæœæ¥é¿å…ï¼Œç”¨çš„æ›´å¤šçš„å¯èƒ½æ˜¯ä¸‹é¢çš„åœºæ™¯ã€‚

**åœºæ™¯äºŒ**

ç”¨æˆ·åœ¨è¾“å…¥æ¡†è¾“å…¥æ–‡å­—ä¹‹åï¼Œéœ€è¦å°†è¾“å…¥çš„æ–‡å­—å‘é€ç»™åå°å¹¶è·å–åˆ°æ•°æ®ã€‚æˆ‘ä»¬çŸ¥é“è¿™æ ·çš„éœ€æ±‚ä¸€èˆ¬éƒ½æ˜¯é€šè¿‡ç›‘å¬è¾“å…¥æ¡†å†…å®¹çš„æ”¹å˜ï¼Œç„¶åå°†æœ€æ–°çš„å†…å®¹ä¼ é€’ç»™åå°ã€‚ä½†è‹¥æ˜¯æ¯è¾“å…¥ä¸€ä¸ªå­—æˆ–è€…ä¸€ä¸ªæ‹¼éŸ³å°±å‘é€ä¸€ä¸ªè¯·æ±‚æ˜¯å¦å°±ä¼šäº§ç”Ÿå¤§é‡å¤šä½™çš„è¯·æ±‚ï¼Œæ­¤æ—¶ï¼Œä½¿ç”¨**é˜²æŠ–**æ— ç–‘æ˜¯éå¸¸æœ‰å¿…è¦çš„ã€‚

## é˜²æŠ–

### éç«‹å³æ‰§è¡Œé˜²æŠ–

ç›¸ä¿¡å¤§å®¶çœ‹åˆ°ä¸Šé¢çš„éœ€æ±‚å°±çŸ¥é“ï¼Œé˜²æŠ–çš„å®ç°è‚¯å®šç¦»ä¸å¼€å®šæ—¶å™¨äº†ï¼Œæ‰€ä»¥æˆ‘ä»¬å…ˆæ¥å®ç°ä¸€ä¸ªç®€æ˜“ç‰ˆçš„é˜²æŠ–ï¼š

```javascript
// funcæ˜¯ç”¨æˆ·ä¼ å…¥éœ€è¦é˜²æŠ–çš„å‡½æ•°
// waitæ˜¯ç­‰å¾…æ—¶é—´
const debounce = (func, wait = 500) => {
  // ç¼“å­˜ä¸€ä¸ªå®šæ—¶å™¨id
  let timer = 0
  // è¿™é‡Œè¿”å›çš„å‡½æ•°æ˜¯æ¯æ¬¡ç”¨æˆ·å®é™…è°ƒç”¨çš„é˜²æŠ–å‡½æ•°
  return function(...args) { // æ¥æ”¶é¢å¤–çš„å‚æ•°
    if (timer) clearTimeout(timer) // å¦‚æœå·²ç»è®¾å®šè¿‡å®šæ—¶å™¨äº†å°±æ¸…ç©ºä¸Šä¸€æ¬¡çš„å®šæ—¶å™¨
    timer = setTimeout(() => { // å¼€å§‹ä¸€ä¸ªæ–°çš„å®šæ—¶å™¨ï¼Œå»¶è¿Ÿæ‰§è¡Œç”¨æˆ·ä¼ å…¥çš„æ–¹æ³•
      func.apply(this, args)
    }, wait)
  }
}
```

å¯ä»¥çœ‹åˆ°ï¼Œä¸Šé¢çš„`debounce`å‡½æ•°åˆ©ç”¨å®šæ—¶å™¨å°†è¦æ‰§è¡Œçš„å‡½æ•°`func`æ”¾åˆ°äº‹ä»¶é˜Ÿåˆ—ä¸­ï¼Œç­‰è¿‡äº†`wait`æ—¶é•¿åå°±ä¼šæ‰§è¡Œã€‚è‹¥æ˜¯åœ¨è¿˜æ²¡è¿‡`wait`æ—¶é•¿å°±å†æ¬¡è§¦å‘äº†å°±ä¼šæ¸…ç©ºæ‰ä¸Šä¸€ä¸ªå®šæ—¶å™¨(ä¹Ÿå°±æ˜¯å–æ¶ˆäº†ä¸Šæ¬¡çš„`func`)ï¼Œä»è€Œé‡æ–°è®¡ç®—`func`æ‰§è¡Œçš„æ—¶é—´ã€‚

äº†è§£äº†åŸç†ä¹‹åï¼Œæˆ‘ä»¬å°±çŸ¥é“ä¸Šé¢çš„å‡½æ•°å¹¶ä¸ä¼šåœ¨ä¸€å¼€å§‹å°±æ‰§è¡Œï¼Œè€Œæ˜¯åœ¨è¿‡äº†`wait`æ—¶é•¿ä¹‹åæ‰æ‰§è¡Œï¼Œåƒè¿™ç§æƒ…å†µï¼Œæˆ‘ä»¬ç§°å®ƒä¸º**éç«‹å³æ‰§è¡Œé˜²æŠ–**ã€‚

æ¡ˆä¾‹1ğŸŒ°

```html
<body>
    <input id="text" onkeyup="changeInput(event)" />
    <p id="result"></p>
    <script>
        let text = document.querySelector('#text')
        let result = document.querySelector('#result')
        function changeInput (event) {
            // console.log(event.target.value)
            debouncePostValue(event.target.value)
        }
        function debounce (func, await = 500) {
            let timer = null;
            return function (...param) {
                if (timer) clearTimeout(timer)
                timer = setTimeout(() => {
                    func.apply(this, param)
                }, await)
            }
        }
        const debouncePostValue = debounce(postValue)
        function postValue (value) {
            result.innerHTML = value
        }
    </script>
</body>
```

### ç«‹å³æ‰§è¡Œé˜²æŠ–

**ç«‹å³æ‰§è¡Œé˜²æŠ–**ä¸ä¸Šé¢çš„ç›¸ä¼¼ï¼Œåªä¸è¿‡åœ¨ç¬¬ä¸€æ¬¡è§¦å‘çš„æ—¶å€™ä¼šæ‰§è¡Œä¸€æ¬¡ï¼Œç„¶åè¦ç­‰å¾…`await`æ—¶é•¿ä¹‹åæ‰èƒ½å†æ¬¡è§¦å‘ã€‚

```javascript
function debounce (func, await = 500) {
    let timer = null;
    return function (...param) {
        if (timer) clearTimeout(timer)
        let callNow = !timer
        timer = setTimeout(() => { // åœ¨awaitä¹‹åå°†å®šæ—¶å™¨æ¸…é™¤
            timer = null
        }, await)
        if (callNow) func.apply(this, param)
    }
}
```

æ¡ˆä¾‹2ğŸŒ°

```html
<body>
    <input id="text" onkeyup="changeInput(event)" />
    <p id="result"></p>
    <script>
        let text = document.querySelector('#text')
        let result = document.querySelector('#result')
        function changeInput (event) {
            // console.log(event.target.value)
            debouncePostValue(event.target.value)
        }
        function debounce (func, await = 500) {
            let timer = null;
            return function (...param) {
                if (timer) clearTimeout(timer)
                let callNow = !timer
                timer = setTimeout(() => { // åœ¨awaitä¹‹åå°†å®šæ—¶å™¨æ¸…é™¤
                    timer = null
                }, await)
                if (callNow) func.apply(this, param)
            }
        }
        const debouncePostValue = debounce(postValue)
        function postValue (value) {
            result.innerHTML = value
        }
    </script>
</body>
```



### ç»ˆæé˜²æŠ–

è‹¥æ˜¯å°†æ˜¯å¦ç«‹å³æ‰§è¡Œä½œä¸ºä¸€ä¸ªå‚æ•°ä¼ å…¥å‡½æ•°ä¸­ï¼Œå°±å¯ä»¥åˆæˆæœ€ç»ˆçš„ä¸€ä¸ªé˜²æŠ–å‡½æ•°ã€‚è¿™é‡Œæˆ‘ç”¨åˆ°çš„æ˜¯[yck](https://juejin.im/user/574f8d8d2e958a005fd4edac)å¤§ä½¬æä¾›çš„ä¸€ç§é˜²æŠ–å†™æ³•ï¼š

```javascript
/**
 * é˜²æŠ–å‡½æ•°ï¼Œè¿”å›å‡½æ•°è¿ç»­è°ƒç”¨æ—¶ï¼Œç©ºé—²æ—¶é—´å¿…é¡»å¤§äºæˆ–ç­‰äº waitï¼Œfunc æ‰ä¼šæ‰§è¡Œ
 *
 * @param  {function} func        å›è°ƒå‡½æ•°
 * @param  {number}   wait        è¡¨ç¤ºæ—¶é—´çª—å£çš„é—´éš”
 * @param  {boolean}  immediate   è®¾ç½®ä¸ºtureæ—¶ï¼Œæ˜¯å¦ç«‹å³è°ƒç”¨å‡½æ•°
 * @return {function}             è¿”å›å®¢æˆ·è°ƒç”¨å‡½æ•°
 */
function debounce (func, wait = 50, immediate = true) {
  let timer, context, args

  // å»¶è¿Ÿæ‰§è¡Œå‡½æ•°
  const later = () => setTimeout(() => {
    // å»¶è¿Ÿå‡½æ•°æ‰§è¡Œå®Œæ¯•ï¼Œæ¸…ç©ºç¼“å­˜çš„å®šæ—¶å™¨åºå·
    timer = null
    // å»¶è¿Ÿæ‰§è¡Œçš„æƒ…å†µä¸‹ï¼Œå‡½æ•°ä¼šåœ¨å»¶è¿Ÿå‡½æ•°ä¸­æ‰§è¡Œ
    // ä½¿ç”¨åˆ°ä¹‹å‰ç¼“å­˜çš„å‚æ•°å’Œä¸Šä¸‹æ–‡
    if (!immediate) {
      func.apply(context, args)
      context = args = null
    }
  }, wait)

  // è¿™é‡Œè¿”å›çš„å‡½æ•°æ˜¯æ¯æ¬¡å®é™…è°ƒç”¨çš„å‡½æ•°
  return function(...params) {
    // å¦‚æœæ²¡æœ‰åˆ›å»ºå»¶è¿Ÿæ‰§è¡Œå‡½æ•°ï¼ˆlaterï¼‰ï¼Œå°±åˆ›å»ºä¸€ä¸ª
    if (!timer) {
      timer = later()
      // å¦‚æœæ˜¯ç«‹å³æ‰§è¡Œï¼Œè°ƒç”¨å‡½æ•°
      // å¦åˆ™ç¼“å­˜å‚æ•°å’Œè°ƒç”¨ä¸Šä¸‹æ–‡
      if (immediate) {
        func.apply(this, params)
      } else {
        context = this
        args = params
      }
    // å¦‚æœå·²æœ‰å»¶è¿Ÿæ‰§è¡Œå‡½æ•°ï¼ˆlaterï¼‰ï¼Œè°ƒç”¨çš„æ—¶å€™æ¸…é™¤åŸæ¥çš„å¹¶é‡æ–°è®¾å®šä¸€ä¸ª
    // è¿™æ ·åšå»¶è¿Ÿå‡½æ•°ä¼šé‡æ–°è®¡æ—¶
    } else {
      clearTimeout(timer)
      timer = later()
    }
  }
}
```

ä¸‹é¢æœ‰ä¸€ä¸ªæ¡ˆä¾‹æ˜¯æ¼”ç¤ºäº†å¦‚ä½•è°ƒç”¨ï¼Œå¹¶ä¼ é€’å‚æ•°ï¼š

```html
<body>
    <button onclick="clickBtn()">ç‚¹å‡»</button>
    <p id="result"></p>
    <script>
        let num = 0
        function clickBtn () {
            debouncePostValue('ç‚¹å‡»äº†')
        }
        /**
         * é˜²æŠ–å‡½æ•°ï¼Œè¿”å›å‡½æ•°è¿ç»­è°ƒç”¨æ—¶ï¼Œç©ºé—²æ—¶é—´å¿…é¡»å¤§äºæˆ–ç­‰äº waitï¼Œfunc æ‰ä¼šæ‰§è¡Œ
         *
         * @param  {function} func        å›è°ƒå‡½æ•°
         * @param  {number}   wait        è¡¨ç¤ºæ—¶é—´çª—å£çš„é—´éš”
         * @param  {boolean}  immediate   è®¾ç½®ä¸ºtureæ—¶ï¼Œæ˜¯å¦ç«‹å³è°ƒç”¨å‡½æ•°
         * @return {function}             è¿”å›å®¢æˆ·è°ƒç”¨å‡½æ•°
         */
        function debounce(func, wait = 50, immediate = true) {
            let timer, context, args

            // å»¶è¿Ÿæ‰§è¡Œå‡½æ•°
            const later = () => setTimeout(() => {
                // å»¶è¿Ÿå‡½æ•°æ‰§è¡Œå®Œæ¯•ï¼Œæ¸…ç©ºç¼“å­˜çš„å®šæ—¶å™¨åºå·
                timer = null
                // å»¶è¿Ÿæ‰§è¡Œçš„æƒ…å†µä¸‹ï¼Œå‡½æ•°ä¼šåœ¨å»¶è¿Ÿå‡½æ•°ä¸­æ‰§è¡Œ
                // ä½¿ç”¨åˆ°ä¹‹å‰ç¼“å­˜çš„å‚æ•°å’Œä¸Šä¸‹æ–‡
                if (!immediate) {
                    func.apply(context, args)
                    context = args = null
                }
            }, wait)

            // è¿™é‡Œè¿”å›çš„å‡½æ•°æ˜¯æ¯æ¬¡å®é™…è°ƒç”¨çš„å‡½æ•°
            return function (...params) {
                // å¦‚æœæ²¡æœ‰åˆ›å»ºå»¶è¿Ÿæ‰§è¡Œå‡½æ•°ï¼ˆlaterï¼‰ï¼Œå°±åˆ›å»ºä¸€ä¸ª
                if (!timer) {
                    timer = later()
                    // å¦‚æœæ˜¯ç«‹å³æ‰§è¡Œï¼Œè°ƒç”¨å‡½æ•°
                    // å¦åˆ™ç¼“å­˜å‚æ•°å’Œè°ƒç”¨ä¸Šä¸‹æ–‡
                    if (immediate) {
                        func.apply(this, params)
                    } else {
                        context = this
                        args = params
                    }
                    // å¦‚æœå·²æœ‰å»¶è¿Ÿæ‰§è¡Œå‡½æ•°ï¼ˆlaterï¼‰ï¼Œè°ƒç”¨çš„æ—¶å€™æ¸…é™¤åŸæ¥çš„å¹¶é‡æ–°è®¾å®šä¸€ä¸ª
                    // è¿™æ ·åšå»¶è¿Ÿå‡½æ•°ä¼šé‡æ–°è®¡æ—¶
                } else {
                    clearTimeout(timer)
                    timer = later()
                }
            }
        }
        const debouncePostValue = debounce(postValue, 500, true)
        function postValue(laterParam) {
            result.innerHTML = `${laterParam}:${++num}`
        }
    </script>
</body>
```


## èŠ‚æµ

é˜²æŠ–åŠ¨å’ŒèŠ‚æµæœ¬è´¨æ˜¯ä¸ä¸€æ ·çš„ã€‚é˜²æŠ–åŠ¨æ˜¯å°†å¤šæ¬¡æ‰§è¡Œå˜ä¸ºæœ€åä¸€æ¬¡æ‰§è¡Œï¼ŒèŠ‚æµæ˜¯å°†å¤šæ¬¡æ‰§è¡Œå˜æˆæ¯éš”ä¸€æ®µæ—¶é—´æ‰§è¡Œï¼Œæˆ‘ä»¬æ¥ç›´æ¥çœ‹ä»£ç ï¼š

### ç®€æ˜“ç‰ˆï¼š
```javascript
// èŠ‚æµ æ—¶é—´æˆ³ç‰ˆ
function throttle1 (fn, delay) {
    let prev = 0
    return function () {
        const self = this
        const args = arguments
        const now = +new Date()
        if (now - prev > delay) {
            fn.apply(self, args)
            prev = now
        }
    }
}

// èŠ‚æµ å®šæ—¶å™¨ç‰ˆ
function throttle2 (fn, wait) {
    let timer
    return function () {
        const self = this
        const args = arguments
        if (!timer) {
            timer = setTimeout(() => {
                fn.apply(self, args)
                timer = null
            }, wait);
        }
    }
}
```

### yckå¤§ä½¬çš„ç»ˆæå®ç°
```javascript
/**
 * underscore èŠ‚æµå‡½æ•°ï¼Œè¿”å›å‡½æ•°è¿ç»­è°ƒç”¨æ—¶ï¼Œfunc æ‰§è¡Œé¢‘ç‡é™å®šä¸º æ¬¡ / wait
 *
 * @param  {function}   func      å›è°ƒå‡½æ•°
 * @param  {number}     wait      è¡¨ç¤ºæ—¶é—´çª—å£çš„é—´éš”
 * @param  {object}     options   å¦‚æœæƒ³å¿½ç•¥å¼€å§‹å‡½æ•°çš„çš„è°ƒç”¨ï¼Œä¼ å…¥{leading: false}ã€‚
 *                                å¦‚æœæƒ³å¿½ç•¥ç»“å°¾å‡½æ•°çš„è°ƒç”¨ï¼Œä¼ å…¥{trailing: false}
 *                                ä¸¤è€…ä¸èƒ½å…±å­˜ï¼Œå¦åˆ™å‡½æ•°ä¸èƒ½æ‰§è¡Œ
 * @return {function}             è¿”å›å®¢æˆ·è°ƒç”¨å‡½æ•°
 */
_.throttle = function(func, wait, options) {
    var context, args, result;
    var timeout = null;
    // ä¹‹å‰çš„æ—¶é—´æˆ³
    var previous = 0;
    // å¦‚æœ options æ²¡ä¼ åˆ™è®¾ä¸ºç©ºå¯¹è±¡
    if (!options) options = {};
    // å®šæ—¶å™¨å›è°ƒå‡½æ•°
    var later = function() {
      // å¦‚æœè®¾ç½®äº† leadingï¼Œå°±å°† previous è®¾ä¸º 0
      // ç”¨äºä¸‹é¢å‡½æ•°çš„ç¬¬ä¸€ä¸ª if åˆ¤æ–­
      previous = options.leading === false ? 0 : _.now();
      // ç½®ç©ºä¸€æ˜¯ä¸ºäº†é˜²æ­¢å†…å­˜æ³„æ¼ï¼ŒäºŒæ˜¯ä¸ºäº†ä¸‹é¢çš„å®šæ—¶å™¨åˆ¤æ–­
      timeout = null;
      result = func.apply(context, args);
      if (!timeout) context = args = null;
    };
    return function() {
      // è·å¾—å½“å‰æ—¶é—´æˆ³
      var now = _.now();
      // é¦–æ¬¡è¿›å…¥å‰è€…è‚¯å®šä¸º true
	  // å¦‚æœéœ€è¦ç¬¬ä¸€æ¬¡ä¸æ‰§è¡Œå‡½æ•°
	  // å°±å°†ä¸Šæ¬¡æ—¶é—´æˆ³è®¾ä¸ºå½“å‰çš„
      // è¿™æ ·åœ¨æ¥ä¸‹æ¥è®¡ç®— remaining çš„å€¼æ—¶ä¼šå¤§äº0
      if (!previous && options.leading === false) previous = now;
      // è®¡ç®—å‰©ä½™æ—¶é—´
      var remaining = wait - (now - previous);
      context = this;
      args = arguments;
      // å¦‚æœå½“å‰è°ƒç”¨å·²ç»å¤§äºä¸Šæ¬¡è°ƒç”¨æ—¶é—´ + wait
      // æˆ–è€…ç”¨æˆ·æ‰‹åŠ¨è°ƒäº†æ—¶é—´
 	  // å¦‚æœè®¾ç½®äº† trailingï¼Œåªä¼šè¿›å…¥è¿™ä¸ªæ¡ä»¶
	  // å¦‚æœæ²¡æœ‰è®¾ç½® leadingï¼Œé‚£ä¹ˆç¬¬ä¸€æ¬¡ä¼šè¿›å…¥è¿™ä¸ªæ¡ä»¶
	  // è¿˜æœ‰ä¸€ç‚¹ï¼Œä½ å¯èƒ½ä¼šè§‰å¾—å¼€å¯äº†å®šæ—¶å™¨é‚£ä¹ˆåº”è¯¥ä¸ä¼šè¿›å…¥è¿™ä¸ª if æ¡ä»¶äº†
	  // å…¶å®è¿˜æ˜¯ä¼šè¿›å…¥çš„ï¼Œå› ä¸ºå®šæ—¶å™¨çš„å»¶æ—¶
	  // å¹¶ä¸æ˜¯å‡†ç¡®çš„æ—¶é—´ï¼Œå¾ˆå¯èƒ½ä½ è®¾ç½®äº†2ç§’
	  // ä½†æ˜¯ä»–éœ€è¦2.2ç§’æ‰è§¦å‘ï¼Œè¿™æ—¶å€™å°±ä¼šè¿›å…¥è¿™ä¸ªæ¡ä»¶
      if (remaining <= 0 || remaining > wait) {
        // å¦‚æœå­˜åœ¨å®šæ—¶å™¨å°±æ¸…ç†æ‰å¦åˆ™ä¼šè°ƒç”¨äºŒæ¬¡å›è°ƒ
        if (timeout) {
          clearTimeout(timeout);
          timeout = null;
        }
        previous = now;
        result = func.apply(context, args);
        if (!timeout) context = args = null;
      } else if (!timeout && options.trailing !== false) {
        // åˆ¤æ–­æ˜¯å¦è®¾ç½®äº†å®šæ—¶å™¨å’Œ trailing
	    // æ²¡æœ‰çš„è¯å°±å¼€å¯ä¸€ä¸ªå®šæ—¶å™¨
        // å¹¶ä¸”ä¸èƒ½ä¸èƒ½åŒæ—¶è®¾ç½® leading å’Œ trailing
        timeout = setTimeout(later, remaining);
      }
      return result;
    };
  };
```